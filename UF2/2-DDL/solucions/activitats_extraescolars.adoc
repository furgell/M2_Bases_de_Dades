= Llenguatges SQL: DDL
:doctype: article
:encoding: utf-8
:lang: ca
:toc: left
:toclevels: 3
:numbered:

<<<

== Solucions activitat creació de taules

=== Activitats extraescolars

Sense claus sintètiques:

[source,sql]
----
CREATE TABLE Towns (
  Name        VARCHAR(150) PRIMARY KEY,
  Population  INT UNSIGNED NOT NULL
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;

CREATE TABLE Schools (
  Code        CHAR(8) PRIMARY KEY,
  Name        VARCHAR(150) NOT NULL,
  Town        VARCHAR(150) NOT NULL,
  CONSTRAINT FOREIGN KEY (Town) REFERENCES Towns(Name)
    ON DELETE NO ACTION ON UPDATE CASCADE,
  CONSTRAINT UNIQUE(Name, Town)
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;

CREATE TABLE Children (
  Code        CHAR(15) PRIMARY KEY,
  FirstName   VARCHAR(100) NOT NULL,
  LastName    VARCHAR(200) NOT NULL,
  Phone       CHAR(13) NOT NULL DEFAULT '',
  Town        VARCHAR(150) NOT NULL,
  SchoolCode  CHAR(8) NOT NULL,
  CONSTRAINT FOREIGN KEY (Town) REFERENCES Towns(Name)
    ON DELETE NO ACTION ON UPDATE CASCADE,
  CONSTRAINT FOREIGN KEY (SchoolCode) REFERENCES Schools(Code)
    ON DELETE NO ACTION ON UPDATE CASCADE
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;

CREATE TABLE Activities (
  Name        VARCHAR(100) PRIMARY KEY
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;

CREATE TABLE ActivityOffers (
  SchoolCode  CHAR(8) NOT NULL,
  Activity    VARCHAR(100) NOT NULL,
  Score       DECIMAL(3,1) UNSIGNED NOT NULL,
  Capacity    TINYINT(2) UNSIGNED NOT NULL,
  CONSTRAINT PRIMARY KEY (SchoolCode, Activity),
  CONSTRAINT FOREIGN KEY (SchoolCode) REFERENCES Schools(Code)
    ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT FOREIGN KEY (Activity) REFERENCES Activities(Name)
    ON DELETE CASCADE ON UPDATE CASCADE,
  CHECK (Score BETWEEN 0 AND 10)
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;
----

Amb Id autogenerats:

[source,sql]
----
CREATE TABLE Towns (
  Id          INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  Name        VARCHAR(150) UNIQUE NOT NULL,
  Population  INT UNSIGNED NOT NULL
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;

CREATE TABLE Schools (
  Id          INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  Code        CHAR(8) UNIQUE NOT NULL,
  Name        VARCHAR(150) NOT NULL,
  TownId      INT UNSIGNED NOT NULL,
  CONSTRAINT FOREIGN KEY (TownId) REFERENCES Towns(Id)
    ON DELETE NO ACTION ON UPDATE CASCADE,
  CONSTRAINT UNIQUE(Name, TownId)
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;

CREATE TABLE Children (
  Id          INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  Code        CHAR(15) UNIQUE NOT NULL,
  FirstName   VARCHAR(100) NOT NULL,
  LastName    VARCHAR(200) NOT NULL,
  Phone       CHAR(13) NOT NULL DEFAULT '',
  TownId      INT UNSIGNED NOT NULL,
  SchoolId    INT UNSIGNED NOT NULL,
  CONSTRAINT FOREIGN KEY (TownId) REFERENCES Towns(Id)
    ON DELETE NO ACTION ON UPDATE CASCADE,
  CONSTRAINT FOREIGN KEY (SchoolId) REFERENCES Schools(Id)
    ON DELETE NO ACTION ON UPDATE CASCADE
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;

CREATE TABLE Activities (
  Id          INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  Name        VARCHAR(100) UNIQUE NOT NULL
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;

CREATE TABLE ActivityOffers (
  SchoolId    INT UNSIGNED NOT NULL,
  ActivityId  INT UNSIGNED NOT NULL,
  Score       DECIMAL(3,1) UNSIGNED NOT NULL,
  Capacity    TINYINT(2) UNSIGNED NOT NULL,
  CONSTRAINT PRIMARY KEY (SchoolId, ActivityId),
  CONSTRAINT FOREIGN KEY (SchoolId) REFERENCES Schools(Id)
    ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT FOREIGN KEY (ActivityId) REFERENCES Activities(Id)
    ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;
----
